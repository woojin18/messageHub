<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cash">
	<insert id="insertWebCashInfo">
	/* cash.insertWebCashInfo */
		INSERT	cm_console.CM_WEB_CASH_HIST (
				CORP_ID
		,		CASH_ID
		,		PAYMENT_ID
		,		PAY_MTD
		,		STATUS
		,		CASH_CHARG_AMOUNT
		,		REG_DT
		) VALUES (
				#{corpId}
		,		#{cashId}
		,		#{orderId}
		,		#{payMtd}
		,		#{status}
		,		#{amount}
		,		NOW()
		)
	</insert>
	
	<select id="selectWebCashInfo" resultType="camel">
	/* cash.selectWebCashInfo */
		SELECT	PAYMENT_ID			AS ORDER_ID
		,		CASH_CHARG_AMOUNT	AS AMOUNT
		FROM	cm_console.CM_WEB_CASH_HIST
		WHERE	PAYMENT_ID = #{orderId}
	</select>
	
	<select	id ="selectCashHist_count" resultType="int">
	/* cash.selectCashHist_count */
		SELECT	COUNT(*)
		FROM	(
				SELECT	CASH_CHARG_AMOUNT	AS AMOUNT
				,		'충전캐시'				AS CASH_TYPE
				,		PAY_MTD
				,		REG_DT
				,		'-'					AS EVENT_DT
				FROM	cm_console.CM_WEB_CASH_HIST
				UNION ALL
				SELECT	cch.AMOUNT
				,		'이벤트캐시'
				,		'이벤트캐시'
				,		cc.REG_DT
				,		cc.START_DT + '~' + cc.EXP_DT
				FROM	cm.CM_CASH cc
				INNER JOIN (
					SELECT	MAX(AMOUNT)	AS AMOUNT
					FROM	cm.CM_CASH_HIST
					GROUP BY CORP_ID, CASH_ID
				) cch
		) AA
	</select>
	
	<select	id ="selectCashHist" resultType="camel">
	/* cash.selectCashHist */
		SELECT	CASH_CHARG_AMOUNT	AS AMOUNT
		,		'충전캐시'				AS CASH_TYPE
		,		PAY_MTD
		,		REG_DT
		,		'-'					AS EVENT_DT
		FROM	cm_console.CM_WEB_CASH_HIST
		UNION ALL
		SELECT	cch.AMOUNT
		,		'이벤트캐시'
		,		'이벤트캐시'
		,		cc.REG_DT
		,		cc.START_DT + '~' + cc.EXP_DT
		FROM	cm.CM_CASH cc
		INNER JOIN (
			SELECT	MAX(AMOUNT)	AS AMOUNT
			FROM	cm.CM_CASH_HIST
			GROUP BY CORP_ID, CASH_ID
		) cch
		ORDER BY REG_DT
	</select>
</mapper>