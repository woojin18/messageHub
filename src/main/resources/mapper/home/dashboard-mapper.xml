<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dashboard">

	<select id="selectProjectInfo" resultType="camel">
		/* dashboard.selectProjectInfo */
		SELECT
			CP.PROJECT_ID,
			CP.PROJECT_NAME,
			CP.USE_CH_GRP_INFO,
			CONCAT(CU.USER_NAME, '(', CU.LOGIN_ID ,')') AS USER_INFO,
			DATE_FORMAT(CP.REG_DT, '%Y-%m-%d') AS REG_DT
		FROM	cm_console.CM_PROJECT CP
			INNER JOIN cm_console.CM_USER CU
				ON CP.REG_ID = CU.USER_ID
		WHERE	CP.PROJECT_ID	= #{projectId}
	</select>

	<select id="selectProjectList" resultType="camel">
		/* dashboard.selectProjectList */
		SELECT
			CP.PROJECT_ID,
			CP.PROJECT_NAME,
			CP.PAY_TYPE,
			CP.USE_CH_GRP_INFO,
			CASE 
				WHEN CP.PAY_TYPE = 'Y' THEN '선불'
				ELSE '후불'
			END PAY_TYPE_CD_NAME,
			CP.REG_DT,
			DATE_FORMAT(CP.REG_DT, '%Y-%m-%d') AS REG_DT_YMD
		FROM cm_console.CM_PROJECT CP
			INNER JOIN cm_console.CM_PROJECT_USER CPU
				ON CP.PROJECT_ID = CPU.PROJECT_ID
		WHERE CP.CORP_ID = #{corpId}
		AND	CP.DEL_YN != 'Y'
		AND	CP.USE_YN = 'Y'
		AND CPU.USER_ID = #{userId}
		ORDER BY CP.REG_DT DESC
		LIMIT 3
	</select>

	<select id="selectNoticeList" resultType="camel">
		/* dashboard.selectNoticeList */
		SELECT
			NOTICE_ID,
			NOTICE_TYPE,
			cm_console.fnc_get_cd_name('NOTICE_TYPE', NOTICE_TYPE, 1) AS NOTICE_TYPE_CD_NAME,
			TITLE,
			REG_DT,
			DATE_FORMAT(REG_DT, '%Y-%m-%d') AS REG_DT_YMD
		FROM cm_bo.CM_NOTICE
		WHERE VIEW_TYPE IN ('ALL', 'OUT')
		ORDER BY REG_DT DESC
		LIMIT 3
	</select>

	<select id="selectChTotCnt" resultType="camel">
        /* dashboard.selectChTotCnt */
		SELECT 
		   IFNULL(SUM(SUCC_CNT), 0) AS TOTAL_SUCC_CNT
	     , IFNULL(SUM(FAIL_CNT), 0) AS TOTAL_FAIL_CNT
	     , IFNULL(SUM((CASE CH WHEN 'PUSH' THEN SUCC_CNT ELSE 0 END)), 0) AS PUSH_SUCC_CNT
	     , IFNULL(SUM((CASE CH WHEN 'PUSH' THEN FAIL_CNT ELSE 0 END)), 0) AS PUSH_FAIL_CNT
	     , IFNULL(SUM((CASE CH WHEN 'RCS' THEN SUCC_CNT ELSE 0 END)), 0) AS RCS_SUCC_CNT
	     , IFNULL(SUM((CASE CH WHEN 'RCS' THEN FAIL_CNT ELSE 0 END)), 0) AS RCS_FAIL_CNT
	     , IFNULL(SUM((CASE CH WHEN 'ALIMTALK' THEN SUCC_CNT ELSE 0 END)), 0) AS ALIM_SUCC_CNT
	     , IFNULL(SUM((CASE CH WHEN 'ALIMTALK' THEN FAIL_CNT ELSE 0 END)), 0) AS ALIM_FAIL_CNT
	     , IFNULL(SUM((CASE CH WHEN 'FRIENDTALK' THEN SUCC_CNT ELSE 0 END)), 0) AS FRIEND_SUCC_CNT
	     , IFNULL(SUM((CASE CH WHEN 'FRIENDTALK' THEN FAIL_CNT ELSE 0 END)), 0) AS FRIEND_FAIL_CNT
	     , IFNULL(SUM((CASE CH WHEN 'SMS' THEN SUCC_CNT ELSE 0 END)), 0) AS SMS_SUCC_CNT
	     , IFNULL(SUM((CASE CH WHEN 'SMS' THEN FAIL_CNT ELSE 0 END)), 0) AS SMS_FAIL_CNT
	     , IFNULL(SUM((CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'LMS' THEN SUCC_CNT ELSE 0 END)), 0) AS LMS_SUCC_CNT
	     , IFNULL(SUM((CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'LMS' THEN FAIL_CNT ELSE 0 END)), 0) AS LMS_FAIL_CNT
	     , IFNULL(SUM((CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'MMS' THEN SUCC_CNT ELSE 0 END)), 0) AS MMS_SUCC_CNT
	     , IFNULL(SUM((CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'MMS' THEN FAIL_CNT ELSE 0 END)), 0) AS MMS_FAIL_CNT
      FROM cm.CM_STAT_CH_DAY
     WHERE CORP_ID = #{corpId}
	<if test="serviceType == 'UC'">
	   AND PROJECT_ID = #{projectId}
	</if>
    <choose>
        <when test="startMonthStr != null and startMonthStr != ''">
       AND YMD BETWEEN STR_TO_DATE(CONCAT(#{startMonthStr}, '-01'), '%Y-%m-%d') AND STR_TO_DATE(CONCAT(#{endMonthStr}, '-31'), '%Y-%m-%d')
        </when>
        <otherwise>
       AND YMD BETWEEN STR_TO_DATE(#{startDateStr}, '%Y-%m-%d') AND STR_TO_DATE(#{endDateStr}, '%Y-%m-%d')
        </otherwise>
    </choose>
       AND CH != 'MO'
	</select>

	<select id="selectChSuccFailCntList" resultType="camel">
		/* dashboard.selectChSuccFailCntList */
		SELECT
			AD.DATE,
			IFNULL(CSCD.SUCC_CNT, 0) AS SUCC_CNT,
			IFNULL(CSCD.FAIL_CNT, 0) AS FAIL_CNT
		FROM (
			<choose>
				<when test="startMonthStr != null and startMonthStr != ''">
			SELECT DATE_FORMAT(A.DATE, '%y-%m')	AS DATE
          FROM (SELECT CONCAT(#{startMonthStr}, '-01') + INTERVAL (a.a + (6 * b.a) ) MONTH AS DATE
				</when>
				<otherwise>
			SELECT A.DATE
          FROM (SELECT #{startDateStr} + INTERVAL (a.a + (6 * b.a) ) DAY AS DATE
				</otherwise>
			</choose>
                  FROM (SELECT 0 as a union all select 1 union all select 2 union all select 3 union all select 4 union all select 5) AS a
                     , (SELECT 0 as a union all SELECT 1 union all SELECT 2 union all SELECT 3 union all SELECT 4 union all SELECT 5) AS b) AS A
			<choose>
				<when test="startMonthStr != null and startMonthStr != ''">
			WHERE A.DATE BETWEEN CONCAT(#{startMonthStr}, '-01') AND CONCAT(#{endMonthStr}, '-31')
				</when>
				<otherwise>
			WHERE A.DATE BETWEEN #{startDateStr} AND #{endDateStr}
				</otherwise>
			</choose>
		) AD
		LEFT OUTER JOIN (
			SELECT 
				CH,
                YMD,
                DATE_FORMAT(YMD, '%y-%m') AS YM,
				SUM(SUCC_CNT) AS SUCC_CNT,
				SUM(FAIL_CNT) AS FAIL_CNT
            FROM cm.CM_STAT_CH_DAY
			WHERE CORP_ID = #{corpId}
			<if test="serviceType == 'UC'">
			AND PROJECT_ID = #{projectId}
			</if>
			<if test="channel != 'ALL'">
				<choose>
					<when test="channel == 'LMS'">
						AND CH = 'MMS'
						AND PRODUCT_CODE = #{channel}
					</when>
					<when test="channel == 'MMS'">
						AND CH = #{channel}
						AND PRODUCT_CODE = #{channel}
					</when>
					<otherwise>
						AND CH = #{channel}
					</otherwise>
				</choose>
			</if>
			<choose>
				<when test="startMonthStr != null and startMonthStr != ''">
			AND YMD BETWEEN STR_TO_DATE(CONCAT(#{startMonthStr}, '-01'), '%Y-%m-%d') AND STR_TO_DATE(CONCAT(#{endMonthStr}, '-31'), '%Y-%m-%d')
			AND CH != 'MO'
			GROUP BY DATE_FORMAT(YMD, '%y-%m')
				</when>
				<otherwise>
			AND YMD BETWEEN STR_TO_DATE(#{startDateStr}, '%Y-%m-%d') AND STR_TO_DATE(#{endDateStr}, '%Y-%m-%d')
			AND CH != 'MO'
			GROUP BY YMD
				</otherwise>
			</choose>
		) CSCD
		<choose>
			<when test="startMonthStr != null and startMonthStr != ''">
		ON AD.DATE = CSCD.YM
			</when>
			<otherwise>
		ON AD.DATE = CSCD.YMD
			</otherwise>
		</choose>
		ORDER BY AD.DATE
	</select>

	<select id="selectChFailCodeList" resultType="camel">
        /* dashboard.selectChFailCodeList */
        SELECT RESULT_CODE
             , IFNULL(CCG.GW_MESSAGE, '미등록코드') AS RESULT_MESSAGE
             , SUM(CNT) AS CNT
          FROM 	cm.CM_CODE_GW       CCG
          , 	cm.CM_STAT_RSLT_DAY CSRD
    <choose>
        <when test="startMonthStr != null and startMonthStr != ''">
         WHERE CSRD.YMD BETWEEN CONCAT(#{startMonthStr}, '-01') AND CONCAT(#{endMonthStr}, '-31')
        </when>
        <otherwise>
         WHERE CSRD.YMD BETWEEN #{startDateStr} AND #{endDateStr}
        </otherwise>
    </choose>
           AND CSRD.RESULT_CODE = CCG.GW_CODE
           AND CSRD.RESULT_CODE > '10000'
           AND CORP_ID = #{corpId}
        <if test="serviceType == 'UC'">
           AND CSRD.PROJECT_ID = #{projectId}
        </if>
        <if test="channel != 'ALL'">
            <choose>
                <when test="channel == 'LMS'">
                    AND CSRD.CH = 'MMS'
                </when>
                <otherwise>
                    AND CSRD.CH = #{channel}
                </otherwise>
            </choose>
        </if>
        GROUP BY CSRD.RESULT_CODE
        ORDER BY SUM(CNT) DESC
        LIMIT 10
	</select>

	<select id="selectChFailCodeCntList" resultType="camel">
		/* dashboard.selectChFailCodeCntList */
		SELECT	B.RESULT_CODE
		<choose>
			<when test="startMonthStr != null and startMonthStr != ''">
		,		DATE_FORMAT(A.DATE, '%Y-%m') AS DATE
			</when>
			<otherwise>
		,		A.DATE
			</otherwise>
		</choose>
		,		(
						SELECT	SUM(CNT)
                  		FROM	cm.CM_STAT_RSLT_DAY X
                  		WHERE	X.YMD = A.DATE  
                  		AND		X.RESULT_CODE = B.RESULT_CODE AND CORP_ID = #{corpId}
        <if test="serviceType == 'UC'">
        				AND		PROJECT_ID = #{projectId}
        </if>
        <if test="channel != 'ALL'">
            <choose>
                <when test="channel == 'LMS'">
						AND		X.CH = 'MMS'
                </when>
                <otherwise>
						AND		X.CH = #{channel}
                </otherwise>
            </choose>
        </if>
				) AS CNT
		<choose>
			<when test="startMonthStr != null and startMonthStr != ''">
		FROM	(SELECT 
						CONCAT(#{startMonthStr}, '-01') + INTERVAL (a.a + (6 * b.a) ) MONTH AS DATE
			</when>
			<otherwise>
		FROM	(SELECT 
						#{startDateStr} + INTERVAL (a.a + (6 * b.a) ) DAY AS DATE
			</otherwise>
		</choose>
				FROM 	(SELECT 0 as a union all select 1 union all select 2 union all select 3 union all select 4 union all select 5) AS a
				,		(SELECT 0 as a union all SELECT 1 union all SELECT 2 union all SELECT 3 union all SELECT 4 union all SELECT 5) AS b
		) AS A
		,		(
		<foreach collection="rtnList" index="index" item="data" separator=" UNION ALL">
				SELECT #{data.resultCode} AS RESULT_CODE, #{index} AS OD
		</foreach>
		) AS B
		<choose>
			<when test="startMonthStr != null and startMonthStr != ''">
		WHERE	DATE BETWEEN CONCAT(#{startMonthStr}, '-01') AND CONCAT(#{endMonthStr}, '-31')
			</when>
			<otherwise>
		WHERE	DATE BETWEEN #{startDateStr} AND #{endDateStr}
			</otherwise>
		</choose>
		ORDER BY B.OD, A.DATE
	</select>

	<select id="selectRtUsedTimeLineList" resultType="camel">
		/* dashboard.selectRtUsedTimeLineList */
		SELECT CURDATE() - INTERVAL (a.a + (6 * b.a) ) DAY AS DATE
          FROM (SELECT 0 as a union all select 1 union all select 2 union all select 3 union all select 4 union all select 5) AS a
             , (SELECT 0 as a union all SELECT 1 union all SELECT 2 union all SELECT 3 union all SELECT 4 union all SELECT 5) AS b
	</select>

	<select id="selectRtUsedDataList" resultType="camel">
        /* dashboard.selectRtUsedDataList */
        SELECT SUBSTR(YMDH,9,12) AS DATE
             , IFNULL(SUM(TOT_CNT),0) AS TOT_CNT
             , IFNULL(SUM(CASE CH WHEN 'PUSH' THEN TOT_CNT ELSE 0 END),0) AS PUSH_CNT
             , IFNULL(SUM(CASE CH WHEN 'RCS' THEN TOT_CNT ELSE 0 END),0) AS RCS_CNT
             , IFNULL(SUM(CASE CH WHEN 'FRIENDTALK' THEN TOT_CNT ELSE 0 END),0) AS FRIENDTALK_CNT
             , IFNULL(SUM(CASE CH WHEN 'ALIMTALK' THEN TOT_CNT ELSE 0 END),0) AS ALIMTALK_CNT
             , IFNULL(SUM(CASE CH WHEN 'SMS' THEN TOT_CNT ELSE 0 END),0) AS SMS_CNT
             , IFNULL(SUM(CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'LMS' THEN TOT_CNT ELSE 0 END),0) AS LMS_CNT
             , IFNULL(SUM(CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'MMS' THEN TOT_CNT ELSE 0 END),0) AS MMS_CNT
          FROM (
            SELECT CONCAT(DATE_FORMAT(NOW(), '%Y%m%d'),LPAD(a.a+(b.a-1)*4-1,2,'0')) AS YMDH
                FROM (SELECT 1 AS a UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4) a
                 , (SELECT 1 AS a UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6) b) AS A
          LEFT JOIN cm.CM_STAT_CH_MIN b
            ON YMDHM BETWEEN DATE_FORMAT(NOW(), '%Y%m%d0000') and DATE_FORMAT(NOW(), '%Y%m%d2359')
           AND A.YMDH = SUBSTR(YMDHM, 1, 10)
           AND CORP_ID = #{corpId}
           AND PROJECT_ID = #{projectId}
           AND b.CH != 'MO'
          GROUP BY YMDH
	</select>

	<select id="selectMonthUsedTimeLineList" resultType="camel">
		/* dashboard.selectMonthUsedTimeLineList */
		SELECT CONCAT(DATE_FORMAT(NOW(), '%Y-%m'),'-',LPAD(a.a+(b.a)*6+1,2,'0')) AS DATE
	      FROM (SELECT 0 AS a UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5) a
	         , (SELECT 0 AS a UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5) b
		 WHERE CONCAT(DATE_FORMAT(NOW(), '%Y-%m'),'-',LPAD(a.a+(b.a)*6+1,2,'0')) BETWEEN LAST_DAY(CURDATE() - INTERVAL 1 MONTH) + INTERVAL 1 DAY AND LAST_DAY(CURDATE())
	</select>

	<select id="selectMonthUsedDataList" resultType="camel">
		/* dashboard.selectMonthUsedDataList */
		SELECT A.DATE
		         , IFNULL(SUM(CASE CH WHEN 'PUSH' THEN TOT_CNT ELSE 0 END),0) AS PUSH_CNT
		         , IFNULL(SUM(CASE CH WHEN 'RCS' THEN TOT_CNT ELSE 0 END),0) AS RCS_CNT
		         , IFNULL(SUM(CASE CH WHEN 'FRIENDTALK' THEN TOT_CNT ELSE 0 END),0) AS FRIENDTALK_CNT
		         , IFNULL(SUM(CASE CH WHEN 'ALIMTALK' THEN TOT_CNT ELSE 0 END),0) AS ALIMTALK_CNT
		         , IFNULL(SUM(CASE CH WHEN 'SMS' THEN TOT_CNT ELSE 0 END),0) AS SMS_CNT
		         , IFNULL(SUM(CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'LMS' THEN TOT_CNT ELSE 0 END),0) AS LMS_CNT
		         , IFNULL(SUM(CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'MMS' THEN TOT_CNT ELSE 0 END),0) AS MMS_CNT
		  FROM (
		        SELECT CONCAT(DATE_FORMAT(NOW(), '%Y-%m'),'-',LPAD(a.a+(b.a)*6+1,2,'0')) AS DATE
		          FROM (SELECT 0 AS a UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5) a
		             , (SELECT 0 AS a UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5) b
		         WHERE CONCAT(DATE_FORMAT(NOW(), '%Y-%m'),'-',LPAD(a.a+(b.a)*6+1,2,'0')) BETWEEN LAST_DAY(CURDATE() - INTERVAL 1 MONTH) + INTERVAL 1 DAY AND LAST_DAY(CURDATE())) A
		  LEFT JOIN cm.CM_STAT_CH_DAY B
		    ON CORP_ID = #{corpId}
		   AND YMD BETWEEN LAST_DAY(CURDATE() - INTERVAL 1 MONTH) + INTERVAL 1 DAY AND LAST_DAY(CURDATE())
		   AND B.YMD = A.DATE
		   AND B.CH != 'MO'
		 GROUP BY A.DATE
	</select>

	<select id="selectSixMonthUsedTimeLineList" resultType="camel">
		/* dashboard.selectSixMonthUsedTimeLineList */
        SELECT DATE_FORMAT(DATE_ADD(CURDATE(), INTERVAL -A.a MONTH), '%Y-%m') AS DATE
          FROM (SELECT 0 AS a UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6) AS A
         ORDER BY 1
	</select>

	<select id="selectSixMonthUsedDataList" resultType="camel">
		/* dashboard.selectSixMonthUsedDataList */
        SELECT DATE_FORMAT(DATE_ADD(CURDATE(), INTERVAL -A.a MONTH), '%Y-%m') AS DATE
			 , IFNULL(SUM(TOT_CNT),0) AS TOT_CNT
             , IFNULL(SUM(CASE CH WHEN 'PUSH' THEN TOT_CNT ELSE 0 END),0) AS PUSH_CNT
             , IFNULL(SUM(CASE CH WHEN 'RCS' THEN TOT_CNT ELSE 0 END),0) AS RCS_CNT
             , IFNULL(SUM(CASE CH WHEN 'FRIENDTALK' THEN TOT_CNT ELSE 0 END),0) AS FRIENDTALK_CNT
             , IFNULL(SUM(CASE CH WHEN 'ALIMTALK' THEN TOT_CNT ELSE 0 END),0) AS ALIMTALK_CNT
             , IFNULL(SUM(CASE CH WHEN 'SMS' THEN TOT_CNT ELSE 0 END),0) AS SMS_CNT
             , IFNULL(SUM(CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'LMS' THEN TOT_CNT ELSE 0 END),0) AS LMS_CNT
             , IFNULL(SUM(CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'MMS' THEN TOT_CNT ELSE 0 END),0) AS MMS_CNT
          FROM (SELECT 1 AS a UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6) AS A
          LEFT JOIN cm.CM_STAT_CH_MONTH B
            ON YM BETWEEN DATE_FORMAT(DATE_ADD(CURDATE(), INTERVAL-5 MONTH), '%Y-%m-01') AND DATE_FORMAT(CURDATE(), '%Y-%m-31')
           AND CORP_ID = #{corpId}
           AND B.YM = DATE_FORMAT(DATE_ADD(CURDATE(), INTERVAL -A.a MONTH), '%Y-%m-01')
           AND B.CH != 'MO'
          GROUP BY DATE_FORMAT(DATE_ADD(CURDATE(), INTERVAL -A.a MONTH), '%Y-%m-01')
          UNION ALL
          SELECT DATE_FORMAT(B.YMD, '%Y-%m') AS DATE
             ,	IFNULL(SUM(B.TOT_CNT),0) AS TOT_CNT
             , IFNULL(SUM(CASE CH WHEN 'PUSH' THEN TOT_CNT ELSE 0 END),0) AS PUSH_CNT
             , IFNULL(SUM(CASE CH WHEN 'RCS' THEN TOT_CNT ELSE 0 END),0) AS RCS_CNT
             , IFNULL(SUM(CASE CH WHEN 'FRIENDTALK' THEN TOT_CNT ELSE 0 END),0) AS FRIENDTALK_CNT
             , IFNULL(SUM(CASE CH WHEN 'ALIMTALK' THEN TOT_CNT ELSE 0 END),0) AS ALIMTALK_CNT
             , IFNULL(SUM(CASE CH WHEN 'SMS' THEN TOT_CNT ELSE 0 END),0) AS SMS_CNT
             , IFNULL(SUM(CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'LMS' THEN TOT_CNT ELSE 0 END),0) AS LMS_CNT
             , IFNULL(SUM(CASE WHEN CH = 'MMS' AND PRODUCT_CODE = 'MMS' THEN TOT_CNT ELSE 0 END),0) AS MMS_CNT
          FROM 	cm.CM_STAT_CH_DAY B
          WHERE	B.CORP_ID = #{corpId}
          AND	B.YMD BETWEEN DATE_FORMAT(CURDATE(), '%Y-%m-01') AND DATE_FORMAT(CURDATE(), '%Y-%m-31')
          AND   B.CH != 'MO'
	</select>
	
	<select id="selectChMinList" resultType="camel">
		/* dashboard.selectChMinList */
		SELECT	PRODUCT_CODE
		,		SUM(TOT_CNT) AS TOT_CNT
		,		SUM(SENDING_CNT) AS SENDING_CNT 
		,		SUM(WAIT_RPT_CNT) AS WAIT_RPT_CNT 
		,		SUM(SUCC_CNT) AS SUCC_CNT 
		,		SUM(FAIL_CNT) AS FAIL_CNT
		FROM	(
				SELECT	CASE
							WHEN PRODUCT_CODE IN ('RLMS','RMMS', 'RSMS', 'RTPL') THEN 'RCS'
							WHEN PRODUCT_CODE IN ('KFRM2', 'KFRM3', 'KFRT1') THEN 'FRIENDTALK'
							WHEN PRODUCT_CODE = 'KALT1' THEN 'ALIMTALK'
							WHEN PRODUCT_CODE IN ('-') THEN CH
							ELSE PRODUCT_CODE
						END AS PRODUCT_CODE
				,		SUM(TOT_CNT) AS TOT_CNT
				,		SUM(SENDING_CNT) AS SENDING_CNT 
				,		SUM(WAIT_RPT_CNT) AS WAIT_RPT_CNT 
				,		SUM(SUCC_CNT) AS SUCC_CNT 
				,		SUM(FAIL_CNT) AS FAIL_CNT
				FROM 	cm.CM_STAT_CH_MIN
				WHERE	1=1
				AND		CORP_ID = #{corpId}
				<if test="svcType=='UC'">
				AND		PROJECT_ID = #{projectId}
				</if>
				GROUP BY PRODUCT_CODE
				)AA
		GROUP BY PRODUCT_CODE
	</select>
    
    <select id="selectCorpInfo" resultType="camel">
        /* dashboard.selectCorpInfo */
		SELECT a.FEE_TYPE
		     , a.MON_SENDER_LIMIT_AMOUNT
		     , a.CORP_NAME
		     , b.BILL_ID
		     , b.BILL_STATUS
		     , b.HANDLE_REASON AS BILL_REASON
		     , c.STATUS AS SENDER_UP_STATUS
		     , c.REQ_AMOUNT
             , c.REQ_REASON
             , c.HANDLE_REASON AS SENDER_UP_REASON
             , (SELECT COUNT(1) FROM cm_console.CM_PROJECT x WHERE SUBBILL_YN = 'Y' AND a.CORP_ID = x.CORP_ID AND x.USE_YN = 'Y') AS SUB_CNT
		  FROM cm_console.CM_CORP a
		  LEFT JOIN cm_console.CM_BILL b
		    ON b.CORP_ID   = a.CORP_ID
		   AND b.BILL_TYPE = 'PROJECT'
		  LEFT JOIN cm_console.CM_SENDER_UP_REQ c
		    ON c.CORP_ID   = a.CORP_ID
		 WHERE a.CORP_ID   = #{corpId}
		 LIMIT 1
    </select>
    
    <select id="selectBill" resultType="camel">
        /* dashboard.selectBill */
	    SELECT BILL_ID
	         , BILL_REG_NO
	         , BILL_TYPE
	         , BILL_NAME
	         , BILL_STATUS
	         , NAP_CUST_KD_CD
	         , BILL_KIND
	         , BILL_EMAIL
	         , BILL_TEL_NO
	         , BILL_ZIP
	         , BILL_JUSO
	         , BILL_JUSO2
	         , PAY_MTHD_CD
	         , PAY_DT
	         , NAP_CMP_NM
	         , NAP_JUMIN
	         , BANK_CD
	         , BANK_NO
	         , CARD_CD
	         , CARD_NO
	         , CARD_VALD_END_YYMM
	         , SERVICE_ID
	         , SMS_EXP_CNT
	         , RCS_EXP_CNT
	         , KKO_EXP_CNT
	         , PUSH_EXP_CNT
	         , HANDLE_REASON
          FROM cm_console.CM_BILL a
         WHERE a.CORP_ID   = #{corpId}
           AND a.BILL_ID   = #{billId}
         LIMIT 1
    </select>
    
    <delete id="deleteBill">
        /* dashboard.deleteBill - 청구정보 삭제 */
        DELETE 
          FROM cm_console.CM_BILL    
        WHERE CORP_ID        = #{corpId}
          AND BILL_ID        = #{billId}
        LIMIT 1
    </delete>
    
    <insert id="insertSenderUpSeq">
        /* dashboard.insertSenderUpSeq - 한도상향요청 등록 */
        INSERT INTO cm_console.CM_SENDER_UP_REQ (
              CORP_ID
            , REQ_AMOUNT
            , REQ_REASON
            , STATUS
            , REQ_ID
            , REQ_DT
        ) VALUES (
              #{corpId}
            , #{reqAmount}
            , #{reqReason}
            , #{status}
            , #{userId}
            , now()
        )
    </insert>
    
    <delete id="deleteSenderUpSeq">
        /* dashboard.deleteSenderUpSeq - 한도상향요청 삭제 */
        DELETE 
          FROM cm_console.CM_SENDER_UP_REQ            
        WHERE CORP_ID        = #{corpId}
        LIMIT 1
    </delete>

</mapper>