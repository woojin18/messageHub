<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="address">
	<select id="selectAddressCateGrpList" resultType="camel">
		/* address.selectAddressCateGrpList */
		SELECT	ADDRESS_CATEGORY_GRP_ID
			,	CORP_ID
			,	PROJECT_ID					/* 전용: project id 입력, 사용: ALL */
			,	ADDRESS_CATEGORY_GRP_NAME
			,	ADDRESS_CATEGORY_GRP_DESC
			,	USE_YN
			,	REG_ID
			,	REG_DT
		FROM CM_ADDR_CATE_GRP
		WHERE 1=1
		AND	CORP_ID = #{corpId}
	</select>

	<select id="selectAddressGrp" parameterType="hashmap" resultType="camel">
		/* address.selectAddressGrp */
		SELECT
			CACG.ADDRESS_CATEGORY_GRP_ID
			, NULL AS ADDRESS_CATEGORY_ID
			, NULL AS DIS_ORDER
			, CACG.ADDRESS_CATEGORY_GRP_NAME AS ADDRESS_NAME
			, NULL AS PAR_ADDRESS_CATEGORY_ID
		FROM CM_ADDR_CATE_GRP CACG
		WHERE 1=1
			AND CACG.CORP_ID = #{corpId}
			AND	CACG.ADDRESS_CATEGORY_GRP_ID = #{addressCategoryGrpId}
	</select>

	<select id="selectAddressCateList" parameterType="hashmap" resultType="camel">
		/* address.selectAddressCateList 주소록 카테고리 목록 조회 */
		SELECT
			CAC.ADDRESS_CATEGORY_ID
			, CAC.ADDRESS_CATEGORY_GRP_ID
			, NULL AS GRP_DIS_ORDER
			, CAC.DIS_ORDER
			, CAC.ADDRESS_CATEGORY_NAME  AS ADDRESS_NAME
			, CAC.PAR_ADDRESS_CATEGORY_ID
		FROM CM_ADDR_CATE_GRP CACG
		INNER JOIN CM_ADDR_CATE CAC
			ON CACG.ADDRESS_CATEGORY_GRP_ID = CAC.ADDRESS_CATEGORY_GRP_ID
			AND CAC.DEL_YN = 'N'
		WHERE 1=1
			AND CACG.CORP_ID = #{corpId}
			AND	CACG.ADDRESS_CATEGORY_GRP_ID = #{addressCategoryGrpId}
		ORDER BY CAC.DIS_ORDER
	</select>
	
	<select id="selectAddressMemList" parameterType="hashmap" resultType="camel">
		/* address.selectAddressMemList 주소록 구성원 조회 */
		SELECT
			B.CU_INFO_ID
		,	B.CU_NAME
		,	B.CUID
		,	B.HP_NUMBER
		FROM ( 
				SELECT CU_INFO_ID
				FROM CM_ADDR_CATE_MEM
				WHERE ADDRESS_CATEGORY_ID = #{addressCategoryId}
		) A
		INNER JOIN CM_CU_INFO B
		ON		A.CU_INFO_ID = B.CU_INFO_ID
		WHERE	B.USE_YN = 'Y'
		ORDER BY B.CU_NAME ASC
	</select>
	
	<select id="selectProjectList" parameterType="hashmap" resultType="camel">
		/* address.selectProjectList 프로젝트 조회 */
		SELECT 
			B.PROJECT_ID
		,	B.PROJECT_NAME
		FROM CM_PROJECT_USER A
		INNER JOIN CM_PROJECT B
		ON A.PROJECT_ID = B.PROJECT_ID
		WHERE A.USER_ID = #{userId}
	</select>
	
	<insert id="insertAddressCateGrp">
		/* address.insertAddressCateGrp 주소록 등록 */
		INSERT INTO	CM_ADDR_CATE_GRP (
				ADDRESS_CATEGORY_GRP_ID
		,		CORP_ID
		,		PROJECT_ID
		,		ADDRESS_CATEGORY_GRP_NAME
		,		ADDRESS_CATEGORY_GRP_DESC
		,		USE_YN
		,		REG_ID
		,		REG_DT
		)	VALUES (
				(SELECT IFNULL(MAX(ADDRESS_CATEGORY_GRP_ID) + 1, 1) FROM CM_ADDR_CATE_GRP B)
		,		#{corpId}
		,		#{projectId}
		,		#{addressCategoryGrpName}
		,		#{addressCategoryGrpDesc}
		,		'Y'
		,		#{loginId}
		,		NOW()
		)
	</insert>
	
	<update id="updateAddressCateGrp" parameterType="hashmap">
		/* address.updateAddressCateGrp 주소록 수정*/
		UPDATE CM_ADDR_CATE_GRP
		SET
			PROJECT_ID = #{projectId}
		,	ADDRESS_CATEGORY_GRP_NAME = #{addressCategoryGrpName}
		,	ADDRESS_CATEGORY_GRP_DESC = #{addressCategoryGrpDesc}
		WHERE
			ADDRESS_CATEGORY_GRP_ID = #{addressCategoryGrpId}
	</update>
</mapper>