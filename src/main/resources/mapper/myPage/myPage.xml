<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="myPage">
	<select id="selectMemberInfo" parameterType="string" resultType="camel">
	/* myPage.selectMemberInfo */
		SELECT	USER_ID
		,		LOGIN_ID
		,		USER_NAME
		,		DATE_FORMAT(PWD_UPD_DT, '%Y-%m-%d')	AS PWD_UPD_DT
		,		HP_NUMBER
		,		REP_PROJECT_ID
		FROM	cm_console.CM_USER
		WHERE	USER_ID = #{userId}
	</select>
	
	<update id="updateMemberInfo">
	/* myPage.updateMemberInfo */
		UPDATE	cm_console.CM_USER
		SET		UPD_DT = NOW()
		,		REP_PROJECT_ID = #{repProjectId}
		<if test="loginPwd != null and loginPwd != ''">
		,		LOGIN_PWD = #{loginPwd}
		,		PWD_UPD_DT = NOW()
		</if>
		<if test="hpNumber != null and hpNumber != ''">
		,		HP_NUMBER = #{hpNumber}
		</if>
		WHERE	USER_ID = #{userId}
	</update>
	
	<select id="selectSmsCertifyNumber" resultType="string">
	/* myPage.selectSmsCertifyNumber */
		SELECT	SMS_CERTIFY_NUMBER
		FROM	cm_console.CM_USER
		WHERE	USER_ID = #{userId}
	</select>
	
	<select id="selectQnaList_count" resultType="int">
	/* myPage.selectQnaList_count */
		SELECT	COUNT(1)
		FROM	cm_bo.CM_QUEST_BOARD
		WHERE	1 = 1
		AND		REG_ID = #{userId}
		<if test="srcTitle != null and srcTitle != ''">
		AND		TITLE LIKE CONCAT('%',#{srcTitle},'%')
		</if>
		<if test="srcQuestType != null and srcQuestType != ''">
		AND		QUEST_TYPE = #{srcQuestType}
		</if>
		<if test="srcQuestStatus != null and srcQuestStatus != ''">
		AND		QUEST_STATUS = #{srcQuestStatus}
		</if>
	</select>
	
	<select id="selectQnaList" parameterType="string" resultType="camel">
	/* myPage.selectQnaList */
		SELECT	QUEST_BOARD_ID
		,		(SELECT CODE_NAME_1 FROM cm_bo.CM_CODE WHERE CODE_TYPE_CD = 'QNA_TYPE' AND CODE_VAL_1 = QUEST_TYPE) QUEST_TYPE_STR
		,		QUEST_TYPE
		,		TITLE
		,		A.EMAIL
		,		A.HP_NUMBER
		,		(SELECT CODE_NAME_1 FROM cm_bo.CM_CODE WHERE CODE_TYPE_CD = 'QNA_STATUS' AND CODE_VAL_1 = QUEST_STATUS) QUEST_STATUS_STR
		,		QUEST_STATUS
		,		CONTENT
		,		REPLY
		,		B.USER_NAME				AS REPLY_USER
		,		DATE_FORMAT(A.REPLY_DT, '%Y-%m-%d')	AS REPLY_DT
		FROM	cm_bo.CM_QUEST_BOARD A
		LEFT OUTER JOIN cm_console.CM_USER B
			ON	A.REPLY_ID = B.USER_ID 
		WHERE	1 = 1
		AND		A.REG_ID = #{userId}
		<if test="srcTitle != null and srcTitle != ''">
		AND		TITLE LIKE CONCAT('%',#{srcTitle},'%')
		</if>
		<if test="srcQuestType != null and srcQuestType != ''">
		AND		QUEST_TYPE = #{srcQuestType}
		</if>
		<if test="srcQuestStatus != null and srcQuestStatus != ''">
		AND		QUEST_STATUS = #{srcQuestStatus}
		</if>
		ORDER BY A.REG_DT DESC
	</select>
	
	<insert id="insertQnaInfo">
	/* myPage.insertQnaInfo */
		INSERT INTO cm_bo.CM_QUEST_BOARD (
			QUEST_BOARD_ID
		,	QUEST_TYPE
		,	TITLE
		,	CONTENT
		,	QUEST_STATUS
		,	HP_NUMBER
		,	EMAIL
		,	REG_ID
		,	REG_DT
		) VALUES (
			#{questBoardId}
		,	#{questType}
		,	#{title}
		,	#{content}
		,	'01'
		,	#{hpNumber}
		,	#{email}
		,	#{userId}
		,	NOW()
		)
	</insert>
	
	<update id="updateQnaInfo">
	/* myPage.updateQnaInfo */
		UPDATE	cm_bo.CM_QUEST_BOARD
		SET		QUEST_TYPE	= #{questType}
		,		EMAIL		= #{email}
		,		HP_NUMBER	= #{hpNumber}
		,		TITLE		= #{title}
		,		CONTENT		= #{content}
		,		UPD_ID		= #{userId}
		,		UPD_DT		= NOW()
		WHERE	QUEST_BOARD_ID = #{questBoardId}
	</update>
	
	<delete id="deleteQnaInfo">
	/* myPage.deleteQnaInfo */
		DELETE FROM cm_bo.CM_QUEST_BOARD
		WHERE QUEST_BOARD_ID = #{questBoardId}
	</delete>
	
	<update id="updateCorpInfo">
	/* myPage.updateCorpInfo */
		UPDATE	cm_console.CM_CORP
		SET		CORP_NAME = #{corpName}
		,		CEO_NAME = #{ceoName}
		,		BUSITYPE = #{busitype}
		,		BUSICLASS = #{busiclass}
		,		WOPLACE_ADDRESS = #{woplaceAddress}
		,		WOPLACE_ADDRESS_DETAIL = #{woplaceAddressDetail}
		,		WIRE_TEL = #{wireTel}
		,		FILE_ID = #{fileId}
		WHERE	CORP_ID = #{corpId}
	</update>
	
	<select id="selectProejctListByUserId" resultType="camel">
		/* myPage.selectProejctListByUserId */
		SELECT	A.PROJECT_ID
		,		A.PROJECT_NAME
		FROM	cm_console.CM_PROJECT A
		INNER JOIN	cm_console.CM_PROJECT_USER B
			ON	A.PROJECT_ID = B.PROJECT_ID
		WHERE	B.USER_ID = #{userId}
	</select>
</mapper>