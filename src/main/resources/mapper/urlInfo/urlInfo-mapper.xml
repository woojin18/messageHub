<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="urlInfo">

    <sql id ="whereSelectUrlInfoList">
        <if test="title != null and title != ''">
            AND TITLE LIKE CONCAT('%', #{title}, '%')
        </if>
        <if test="urlId != null and urlId != ''">
            AND URL_ID = #{urlId}
        </if>
        <if test="orgUrl != null and orgUrl != ''">
            AND ORG_URL LIKE CONCAT('%', #{orgUrl}, '%')
        </if>
<!--         <if test="projectId != null and projectId != ''"> -->
<!--             AND PROJECT_ID = #{projectId} -->
<!--         </if> -->
<!--         <if test="corpId != null and corpId != ''"> -->
<!--             AND CORP_ID = #{corpId} -->
<!--         </if> -->
<!--         <if test="userId != null and userId != ''"> -->
<!--             AND REG_ID = #{userId} -->
<!--         </if> -->
        <if test="startDt != null and startDt != '' and v != null and endDt != ''">
            AND REG_DT BETWEEN #{startDt} AND #{endDt}
        </if>
    </sql>

    <select id="selectUrlInfoListCnt" parameterType="hashmap" resultType="int">
    	/* urlInfo.selectUrlInfoListCnt - 단축URL 목록 카운트 조회 */
        SELECT
            COUNT(*) AS CNT
        FROM cm_console.CM_URL_INFO
        WHERE
        	USE_YN = 'Y'
        <include refid="whereSelectUrlInfoList"/>
    </select>

    <select id="selectUrlInfoList" parameterType="hashmap" resultType="camel">
    	/* urlInfo.selectUrlInfoList - 단축URL 목록 조회 */
        SELECT
            @ROWNUM := @ROWNUM + 1 AS ROWNUM,
            URL_ID,
            ORG_URL,
            CORP_ID,
            PROJECT_ID,
            TITLE,
			USE_YN,
			EXP_DT,
			REG_ID,
			REG_DT,
<!-- 			DATE_FORMAT(REG_DT, '%Y%m-%d') AS REG_DT, -->
			UPD_ID,
			UPD_DT
<!-- 			DATE_FORMAT(UPD_DT, '%Y-%m-%d') AS UPD_DT -->
        FROM
        	cm_console.CM_URL_INFO,
        (SELECT @ROWNUM:=0) TMP
        WHERE
        	USE_YN = 'Y'
        <include refid="whereSelectUrlInfoList"/>
        ORDER BY
        	REG_DT DESC
        <if test='pagingYn == "Y" '>
        LIMIT #{offset}, #{listSize}
        </if>
    </select>

	<insert id="insertUrlInfo">
		/* urlInfo.insertUrlInfo - 단축URL 생성 */
		INSERT INTO cm_console.CM_URL_INFO (
			URL_ID,
            ORG_URL,
            CORP_ID,
            PROJECT_ID,
            TITLE,
			USE_YN,
			EXP_DT,
			REG_ID,
			REG_DT
		) VALUES (
			#{urlId},
			#{orgUrl},
			#{corpId},
			#{projectId},
			#{title},
			'Y',
			#{expDt},
			#{userId},
			NOW()
		)
	</insert>

	<delete id="deleteUrlInfo" parameterType="hashmap">
		/* urlInfo.deleteUrlInfo - 단축URL 삭제 */
		UPDATE
			cm_console.CM_URL_INFO
		SET
			USE_YN 	= 'N',
			UPD_ID 	= #{userId}
			UPD_DT 	= NOW()
		WHERE
			URL_ID 		= #{urlId}
	</delete>
</mapper>
