<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="signUp">
	
	<select id="selectDomainChkCount" resultType="int">
		/* signUp.selectDomainChkCount */
		SELECT	COUNT(1)
		FROM	cm_console.CM_CORP
		WHERE	DOMAIN_NAME = #{domainName}
	</select>

	<insert id="insertCmUser">
		/* signUp.insertCmUser */
		INSERT INTO cm_console.CM_USER (
				USER_ID
		,		LOGIN_ID
		,		USER_NAME
		,		LOGIN_PWD
		,		PWD_UPD_DT
		,		HP_NUMBER
		,		APPROVAL_STATUS
		,		DEL_YN
		,		CORP_ID
		,		ROLE_CD
		,		PROMOTION_YN
		,		REG_ID
		,		REG_DT
		,		SALT
		) VALUES (
				#{userId}
		,		#{loginId}
		,		#{userNm}
		,		#{password}
		,		NOW()
		,		#{phoneCerti}
		,		'Y'
		,		'N'
		,		#{corpId}
		,		#{cmRole}
		,		#{promotionYn}
		,		#{userId}
		,		NOW()
		,		#{salt}
		)
	</insert>

	<select id="selectCmUseTerms" resultType = "camel">
		/* signUp.selectCmUseTerms */
		SELECT	SVC_TERMS_ID
		,		TERMS_CONTENT
		FROM	cm_bo.CM_USE_TERMS
		WHERE	TERMS_CD = #{srcTermsCd}
		AND		USE_YN = 'Y'
		ORDER BY REG_DT DESC
		LIMIT 1
	</select>

	<select id="selectCmUseTermsPriVersion" resultType = "camel">
		/* signUp.selectCmUseTermsPriVersion */
		SELECT	SVC_TERMS_ID
		,		TERMS_CONTENT
		,		REVISE_DAY
		FROM	cm_bo.CM_USE_TERMS
		WHERE	TERMS_CD = #{srcTermsCd}
		AND		USE_YN = 'N'
		ORDER BY REVISE_DAY DESC
	</select>

	<insert id="insertCmCorp">
		/* signUp.insertCmCorp */
		INSERT INTO cm_console.CM_CORP (
				CORP_ID
		,		CUST_NO
		,		CORP_NAME
		,		REGNO
		,		REG_ID
		,		REG_DT
		,		CEO_NAME
		,		ZIPCODE
		,		WOPLACE_ADDRESS
		,		WOPLACE_ADDRESS_DETAIL
		,		BUSITYPE
		,		BUSICLASS
<!-- 		,		SMS_CERTIFY_YN -->
		,		WIRE_TEL
		,		FILE_ID
		,		FILE_ID1
		,		FILE_ID2
		<if test="fileId3 != null and fileId3 != ''">
		,		FILE_ID3
		</if>
<!-- 		,		DOMAIN_NAME -->
		,		UPD_DT
		,		SALES_ID
		,		SELF_TOKEN
        ,       FEE_TYPE
        ,       MON_SENDER_LIMIT_AMOUNT
		) VALUES (
				#{corpId}
		,		#{custNo}
		,		#{corpNm}
		,		#{regno}
		,		#{userId}
		,		NOW()
		,		#{ceoNm}
		,		#{zipCode}
		,		#{woplaceAddress}
		,		#{woplaceAddressDetail}
		,		#{busiType}
		,		#{busiClass}
<!-- 		,		#{smsCertifyYn} -->
		,		#{wireTel}
		,		#{fileId}
		,		#{fileId1}
		,		#{fileId2}
		<if test="fileId3 != null and fileId3 != ''">
		,		#{fileId3}
		</if>
<!-- 		,		#{domainName} -->
		,		NOW()
		,		#{salesMan}
		,		#{coInfo1}
        ,       #{feeType}
        ,       3000000
		)
	</insert>
	
	<select id="checkMailCertifyByAuthKey" resultType="camel">
		/* signUp.checkMailCertifyByAuthKey */
		SELECT	EMAIL
		,		DATE_FORMAT(MAIL_CERTIFY_DT, '%Y-%m-%d %H:%i:%s')	AS MAIL_CERTIFY_DT
		,		PROMOTION_YN
		FROM	cm_console.CM_MAIL_CERTIFY
		WHERE	MAIL_CERTIFY_KEY =#{authKey}
	</select>
	
	<insert id="insertCmMailCertify">
		/* signUp.insertCmMailCertify */
		INSERT INTO cm_console.CM_MAIL_CERTIFY (
				EMAIL
		,		MAIL_CERTIFY_KEY
		,		MAIL_CERTIFY_DT
		<if test="promotionYn != '' and promotionYn != null">
		,		PROMOTION_YN
		</if>
		,		REG_DT
		) VALUES (
				#{email}
		,		#{authKey}
		<choose>
			<when test="time != '' and time != null">
		,		#{time}
			</when>
			<otherwise>
		,		DATE_ADD(NOW(), INTERVAL 24 HOUR)
			</otherwise>
		</choose>
		<if test="promotionYn != '' and promotionYn != null">
		,		#{promotionYn}
		</if>
		,		NOW()
		)
	</insert>
	
	<select id="selectIsExistCustNo" resultType="int">
		/* signUp.selectIsExistCustNo */
		SELECT EXISTS (
			SELECT	CUST_NO
			FROM	cm_console.CM_CORP
			WHERE	CUST_NO = #{custNo}
			AND		STATUS IN ('USE', 'STOP')
		)
	</select>
	
	<select id="selectCustNoDuplicateYn" resultType="string">
		/* signUp.selectCustNoDuplicateYn */
		SELECT	USE_YN
		FROM	cm_bo.CM_CODE_TYPE
		WHERE	CODE_TYPE_CD = 'CUST_NO_DULICATE'
	</select>
	
	<select id="selectDefaultSalesManId" resultType="string">
		/* signUp.selectDefaultSalesManId */
		SELECT	CODE_VAL_1
		FROM	cm_bo.CM_CODE cc 
		WHERE	CODE_TYPE_CD = 'SALES_MAN'
		AND		CODE_VAL_3  = 'Y'
		LIMIT 1
	</select>
	
	<insert id="insertBill">
        /* signUp.insertBill - 청구정보 등록 */
        INSERT INTO CM_BILL (
            CORP_ID
          , BILL_ID
          , BILL_REG_NO
          , BILL_TYPE
          , BILL_NAME
          , BILL_STATUS
          , NAP_CUST_KD_CD
          , BILL_KIND
          , BILL_EMAIL
          , BILL_TEL_NO
          , BILL_ZIP
          , BILL_JUSO
          , BILL_JUSO2
          , PAY_MTHD_CD
          , PAY_DT
          , NAP_CMP_NM
          , NAP_JUMIN
          , BANK_CD
          , BANK_NO
          , CARD_CD
          , CARD_NO
          , CARD_VALD_END_YYMM
          , SERVICE_ID
          , SMS_EXP_CNT
          , RCS_EXP_CNT
          , KKO_EXP_CNT
          , PUSH_EXP_CNT
          , MONTH_EXP_AMOUNT
          , REG_ID
          , REG_DT
        ) VALUES (
            #{corpId}
          , #{billId}
          , #{billRegNo}
          , #{billType}
          , #{billName}
          , #{billStatus}
          , #{napCustKdCd}
          , #{billKind}
          , #{billEmail}
          , #{billTelNo}
          , #{billZip}
          , #{billJuso}
          , #{billJuso2}
          , #{payMthdCd}
          , #{payDt}
          , #{napCmpNm}
          , #{napJumin}
          , #{bankCd}
          , #{bankNo}
          , #{cardCd}
          , #{cardNo}
          , #{cardValdEndYymm}
          , #{serviceId}
          , #{smsExpCnt}
          , #{rcsExpCnt}
          , #{kkoExpCnt}
          , #{pushExpCnt}
          , #{monthExpAmount}
          , #{userId}   
          , now()
        )
	</insert>
	
	<update id="updateBill">
        /* signUp.updateBill - 청구정보 수정 */
        UPDATE CM_BILL
           SET BILL_REG_NO        = #{billRegNo}        
             , BILL_TYPE          = #{billType}            
             , BILL_NAME          = #{billName}       
             , BILL_STATUS        = #{billStatus}     
             , NAP_CUST_KD_CD     = #{napCustKdCd}    
             , BILL_KIND          = #{billKind}       
             , BILL_EMAIL         = #{billEmail}      
             , BILL_TEL_NO        = #{billTelNo}      
             , BILL_ZIP           = #{billZip}        
             , BILL_JUSO          = #{billJuso}       
             , BILL_JUSO2         = #{billJuso2}      
             , PAY_MTHD_CD        = #{payMthdCd}      
             , PAY_DT             = #{payDt}          
             , NAP_CMP_NM         = #{napCmpNm}       
             , NAP_JUMIN          = #{napJumin}       
             , BANK_CD            = #{bankCd}         
             , BANK_NO            = #{bankNo}         
             , CARD_CD            = #{cardCd}         
             , CARD_NO            = #{cardNo}         
             , CARD_VALD_END_YYMM = #{cardValdEndYymm}
             , SERVICE_ID         = #{serviceId}      
             , SMS_EXP_CNT        = #{smsExpCnt}      
             , RCS_EXP_CNT        = #{rcsExpCnt}      
             , KKO_EXP_CNT        = #{kkoExpCnt}      
             , PUSH_EXP_CNT       = #{pushExpCnt}     
             , MONTH_EXP_AMOUNT   = #{monthExpAmount}
             , HANDLE_REASON      = null
             , HANDLE_ID          = null
             , HANDLE_DT          = null
             , REG_ID             = #{userId}
             , REG_DT             = now()
         WHERE CORP_ID            = #{corpId}
           AND BILL_ID            = #{billId}  
	</update>
</mapper>